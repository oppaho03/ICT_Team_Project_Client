<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>char.js Test</title>
</head>
<body>
    <!-- 그래프 표시할 곳 -->
    <div>
        <canvas id="myChart" ></canvas>
    </div>

    <!-- Chart.js & Adapter 모두 script 방식으로 불러오기 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script> <!-- Char.js 사용하기 위해 필요 -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script> <!-- 날짜 관련 처리 -->

    <script type="module">
        import {CHART_COLORS} from "./Utils.js";

        const ctx = document.getElementById('myChart');


        //데이터 (x:날짜+시간, y:감정지수)
        const data = [
            { x: '2025-04-01T09:00:00', y: 50 },
            { x: '2025-04-02T12:00:00', y: -20 },
            { x: '2025-04-03T09:00:00', y: 80 },
            { x: '2025-04-03T18:00:00', y: 20 },
            { x: '2025-04-04T09:00:00', y: -10 },
            { x: '2025-04-04T15:00:00', y: 30 },
            { x: '2025-04-04T19:00:00', y: 70 },
            { x: '2025-04-04T22:00:00', y: 10 },
            { x: '2025-04-05T09:00:00', y: 35 },
            { x: '2025-04-06T09:00:00', y: 99 },
            { x: '2025-04-06T15:00:00', y: 70 },
            { x: '2025-04-06T19:00:00', y: 10 }
        ];

        //애니메이션 설정 정보

        const animation = { 
            duration: 1500,
            easing: 'easeInOutQuart',
            // 포인트와 선이 같이 부드럽게 표시되게 함
            x: {
                easing: 'easeInOutQuart', //애니메이션이 서서히 시작 → 중간에 가속 → 다시 서서히 멈춤
                duration: 1500, //1초동안 지속
                from: NaN  //시작값을 자동으로 계산 못함
            },
            y: {
                easing: 'easeInOutQuart',
                duration: 1500,
                from: NaN
            }
        };

        const animations = { 
            tension: {
            duration: 1500,
            easing: 'easeInOutQuad',
            from: 0.8,
            to: 0.4,
            loop: false
            }
        };

        
        //차트 생성
        new Chart(ctx, {
            type: 'line', //차트유형
            data: {
            // labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'], //차트의 각 데이터 포인트에 대한 레이블 (x축)
            datasets: [{ //차트에 표시되는 데이터 정의
                borderColor: CHART_COLORS.red, //선 색
                borderWidth: 1 , //선 굵기
                tension: 0.4, // 곡선의 부드러움 정도(0:직선, 1에 가까울수록 부드러움)

                fill: false, //선 아래 영역을 채우느냐 여부를 결정(true:채움, false:안채움(기본값), 'origin':0을 기준으로 위/아래 채움 )
                backgroundColor: CHART_COLORS.yellow, //fill: true일 때 채워지는 배경 색상, 또는 바/포인트 내부 색상
                
                label: '감정', //데이터셋의 레이블 
                data: data, //차트에 표시할 실제 데이터값
                // showLine: false, // 선 없애고 점만 표시
                pointStyle: 'triangle', //포인트 모양
                pointRadius: 5, //각 점의 크기  
                pointBackgroundColor: CHART_COLORS.blue, //포인트 안쪽 색상
                pointBorderColor: CHART_COLORS.grey //포인트 테두리 색상
            }]
            },
            options: { 
                //애니메이션 설정
                animation: animation, //animation: 전체 차트에 적용되는 기본 애니메이션 설정
                animations: animations, //animations: 속성별(tension, x, y, radius 등)에 개별 애니메이션을 세밀하게 설정
                //축 설정
                scales: {
                    x: {
                        type: 'time',
                        time: {
                                unit: 'day', // x축에는 날짜만 표시(시간은 표시X)
                                displayFormats: {
                                    day: 'yyyy-MM-dd' // 표시 형식 지정
                                }
                        },
                        title: {
                            display: true,
                            text: '날짜'
                        },
                        ticks: {
                            source: 'data', // 데이터 기준으로 날짜만 보여줌
                            autoSkip: true
                        }
                    },
                    y: {
                        min: -100, // y축 최솟값 (아래로)
                        max: 100,  // y축 최댓값 (위로)
                        ticks: {
                            stepSize: 20 // 눈금 간격 
                        },
                        title: {
                            display: true,
                            text: '감정 지수'
                        }
                    }
                },
                plugins: {
                    tooltip: { //그래프 위에 마우스를 올렸을 때 나오는 작은 팝업창 조절
                        mode: 'point',
                        intersect: false, //false: 마우스가 데이터 포인트 위에 정확히 안 올라도, 가까이만 가면 툴팁이 뜨게 함
                        callbacks: {
                            title: (tooltipItems) => { //툴팁의 제목 부분을 커스터마이징
                                // 마우스 올렸을 때 날짜 + 시간 보이게
                                const rawDate = tooltipItems[0].parsed.x;
                                const date = new Date(rawDate);
                                return date.toLocaleString(); // 브라우저 로케일에 맞게 포맷
                            }
                        }
                    }
                }
            }
        }); 

    </script>
</body>
</html>